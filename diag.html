<!doctype html>
<meta charset="utf-8">
<title>Linear Desk – Browser Diagnostics</title>
<style>
  body {font:14px system-ui, -apple-system, Segoe UI, Roboto, Arial; margin:24px; line-height:1.45}
  fieldset{margin:18px 0; padding:18px}
  input,textarea{width:100%; max-width:700px}
  .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .log{white-space:pre-wrap; background:#111; color:#eee; padding:10px; border-radius:8px}
</style>

<h1>Linear Desk – Browser Diagnostics</h1>

<fieldset>
  <legend><b>Form A</b>: Direct to <code>https://api.help.linearit.co/</code> (create ticket)</legend>
  <div class="row"><label style="min-width:140px">Name</label><input id="a_name" placeholder="Test User"></div>
  <div class="row"><label style="min-width:140px">Email</label><input id="a_email" placeholder="you@example.com"></div>
  <div class="row"><label style="min-width:140px">Subject</label><input id="a_subject" placeholder="Diag from browser"></div>
  <div class="row"><label style="min-width:140px">Message</label><textarea id="a_message" rows="4">Testing multipart direct to API</textarea></div>
  <div class="row"><label style="min-width:140px">Files</label><input id="a_files" type="file" multiple></div>
  <button id="a_send">Send A</button>
  <div id="a_out" class="log"></div>
</fieldset>

<fieldset>
  <legend><b>Form B</b>: To <code>https://api.help.linearit.co/admin/email/mailgun/&lt;MG_TOKEN&gt;</code> (simulate Mailgun POST)</legend>
  <div class="row"><label style="min-width:140px">MG Token (path)</label><input id="b_token" placeholder="your MG_TOKEN exactly"></div>
  <div class="row"><label style="min-width:140px">From</label><input id="b_from" value="Client &lt;client@example.com&gt;"></div>
  <div class="row"><label style="min-width:140px">Sender</label><input id="b_sender" value="client@example.com"></div>
  <div class="row"><label style="min-width:140px">Subject</label><input id="b_subject" value="Diag via mailgun-inbound"></div>
  <div class="row"><label style="min-width:140px">Body</label><textarea id="b_body" rows="4">This came via the inbound worker</textarea></div>
  <div class="row"><label style="min-width:140px">Attachments</label><input id="b_files" type="file" multiple></div>
  <button id="b_send">Send B</button>
  <div id="b_out" class="log"></div>
</fieldset>

<script>
const API = "https://api.help.linearit.co";

async function sendA(){
  const fd = new FormData();
  fd.append("name", document.getElementById("a_name").value || "Diag User");
  fd.append("email", document.getElementById("a_email").value || "diag@example.com");
  fd.append("subject", document.getElementById("a_subject").value || "Diag multipart");
  fd.append("message", document.getElementById("a_message").value || "Testing");
  const files = document.getElementById("a_files").files;
  for (const f of files) fd.append("files", f);

  const out = document.getElementById("a_out");
  out.textContent = "POST " + API + "/ …";
  try{
    // No credentials needed for public intake
    const r = await fetch(API + "/", { method:"POST", body: fd });
    const t = await r.text();
    out.textContent = "Status: " + r.status + "\n\n" + t;
  }catch(e){
    out.textContent = "Network error: " + e;
  }
}

async function sendB(){
  const token = (document.getElementById("b_token").value || "").trim();
  const url = API + "/admin/email/mailgun/" + encodeURIComponent(token);
  const fd = new FormData();
  fd.append("from", document.getElementById("b_from").value || "Client <client@example.com>");
  fd.append("sender", document.getElementById("b_sender").value || "client@example.com");
  fd.append("subject", document.getElementById("b_subject").value || "Diag inbound");
  fd.append("body-plain", document.getElementById("b_body").value || "Hello from browser diag");
  const files = document.getElementById("b_files").files;
  let idx = 1;
  for (const f of files) fd.append("attachment-" + (idx++), f);

  const out = document.getElementById("b_out");
  out.textContent = "POST " + url + " …";
  try{
    const r = await fetch(url, { method:"POST", body: fd });
    const t = await r.text();
    out.textContent = "Status: " + r.status + "\n\n" + t;
  }catch(e){
    out.textContent = "Network error: " + e;
  }
}

document.getElementById("a_send").onclick = (e)=>{ e.preventDefault(); sendA(); };
document.getElementById("b_send").onclick = (e)=>{ e.preventDefault(); sendB(); };
</script>
