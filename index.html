<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Linear Desk — Request Support</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e5e7eb;--border:#1f2937}
    html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:720px;margin:32px auto;padding:0 16px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px}
    label{display:block;margin:10px 0 4px;color:#cbd5e1}
    input,textarea,select{width:100%;background:#0b1730;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px}
    button{background:#111827;color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer;margin-top:12px}
    button:hover{background:#1f2937}
    .muted{color:var(--muted);font-size:14px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  </style>
</head>
<body>
<div class="wrap">
  <h1>Request Support</h1>
  <div class="card">
    <form id="f" enctype="multipart/form-data">
      <input type="text" name="honeypot" style="display:none" autocomplete="off" />
      <label>Your name</label>
      <input name="name" required placeholder="Full name"/>

      <label>Your email</label>
      <input name="email" type="email" required placeholder="you@example.com"/>

      <label>Subject</label>
      <input name="subject" required placeholder="Brief summary"/>

      <label>Message</label>
      <textarea name="message" rows="6" required placeholder="Describe what’s going on…"></textarea>

      <div class="row">
        <div style="flex:1">
          <label>Priority</label>
          <select name="priority">
            <option value="normal">Normal</option>
            <option value="high">High</option>
          </select>
        </div>
        <div style="flex:1">
          <label>Category</label>
          <select name="category">
            <option value="general">General</option>
            <option value="hardware">Hardware</option>
            <option value="software">Software</option>
            <option value="network">Network</option>
          </select>
        </div>
      </div>

      <label>Attachments <span class="muted">(optional — if applicable, please add a screenshot or photo)</span></label>
      <input type="file" name="files" id="files" multiple />
      <div id="chosen" class="muted"></div>

      <button id="btn">Submit</button>
      <div id="msg" class="muted"></div>
    </form>
  </div>
</div>

<script>
const API = "https://api.help.linearit.co";
const $ = id => document.getElementById(id);

function humanBytes(n){if(n===0)return"0 B";if(!n)return"";const u=['B','KB','MB','GB'];let i=0;while(n>=1024&&i<u.length-1){n/=1024;i++}return n.toFixed(i?1:0)+" "+u[i]}

const filesInput = $("files");
const chosen = $("chosen");
filesInput.onchange = () => {
  const fs = Array.from(filesInput.files || []);
  if (fs.length === 0) { chosen.textContent = ""; return; }
  let total = 0;
  chosen.innerHTML = fs.map(f => { total += f.size||0; return `${f.name} — ${f.type||"application/octet-stream"} — ${humanBytes(f.size)}`; }).join(" | ");
  chosen.innerHTML += ` <em>(Total ${humanBytes(total)})</em>`;
};

$("f").addEventListener("submit", async (e) => {
  e.preventDefault();
  $("msg").textContent = "Submitting…";

  const fd = new FormData($("f"));
  // IMPORTANT: ensure "files" appears once per attachment (browser does this automatically for multiple)

  try {
    const r = await fetch(`${API}/`, { method: "POST", body: fd, credentials: "include" });
    const j = await r.json().catch(() => ({}));
    if (!r.ok || !j.ok) {
      $("msg").textContent = `Error: ${(j && j.error) || r.status}`;
      return;
    }
    $("msg").textContent = `Submitted! Ticket #${j.issue_number}`;
    $("f").reset();
    chosen.textContent = "";
  } catch (e) {
    $("msg").textContent = "Network error.";
  }
});
</script>
</body>
</html>
